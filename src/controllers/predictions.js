
const tf = require('@tensorflow/tfjs-node');

const sample = [[
    [[-0.9959879 ],
    [-0.15322888],
    [ 0.51714754],
    [ 0.7852982 ],
    [-3.5051112 ],
    [12.047623  ]],

    [[-0.38307226],
    [-0.61291564],
    [-0.4213795 ],
    [ 0.93852705],
    [-3.5625722 ],
    [ 0.05746102]],

    [[-2.087744  ],
    [ 1.7046717 ],
    [ 0.61291564],
    [-1.0342951 ],
    [ 0.19153613],
    [-3.7541084 ]],

    [[-2.1068976 ],
    [ 0.01915359],
    [ 0.8810662 ],
    [-0.26815057],
    [ 6.339846  ],
    [-6.14831   ]],

    [[-1.2641385 ],
    [-0.84275913],
    [ 0.47884035],
    [ 0.40222585],
    [13.005303  ],
    [-6.6654572 ]],

    [[-1.0342951 ],
    [-0.22984338],
    [ 0.38307226],
    [ 0.09576809],
    [10.0748005 ],
    [ 2.930503  ]],

    [[-1.1875241 ],
    [ 0.153229  ],
    [ 0.40222588],
    [-0.01915362],
    [ 9.710882  ],
    [ 0.3639183 ]],

    [[-1.2258313 ],
    [ 0.03830719],
    [ 0.36391866],
    [ 0.03830722],
    [ 9.576807  ],
    [ 0.13407516]],

    [[-1.3215994 ],
    [ 0.09576809],
    [ 0.32561144],
    [ 0.03830722],
    [ 9.5385    ],
    [ 0.03830719]],

    [[-1.2066777 ],
    [-0.11492169],
    [ 0.32561144],
    [ 0.        ],
    [ 9.595961  ],
    [-0.05746078]],

    [[-1.2449849 ],
    [ 0.03830719],
    [ 0.36391866],
    [-0.03830722],
    [ 9.557653  ],
    [ 0.03830719]],

    [[-1.283292  ],
    [ 0.03830719],
    [ 0.30645782],
    [ 0.05746084],
    [ 9.519346  ],
    [ 0.03830719]],

    [[-1.2641385 ],
    [-0.01915359],
    [ 0.32561144],
    [-0.01915362],
    [ 9.519346  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.        ],
    [ 9.5385    ],
    [-0.01915359]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.34476504],
    [-0.01915359],
    [ 9.519346  ],
    [ 0.01915359]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.36391866],
    [-0.01915362],
    [ 9.557653  ],
    [-0.03830719]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.34476504],
    [ 0.01915362],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.576807  ],
    [-0.01915359]],

    [[-1.2258313 ],
    [-0.03830719],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [ 0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.34476504],
    [-0.01915359],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.576807  ],
    [-0.01915359]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.34476504],
    [-0.01915359],
    [ 9.5385    ],
    [ 0.03830719]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.283292  ],
    [ 0.03830719],
    [ 0.32561144],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.283292  ],
    [ 0.        ],
    [ 0.34476504],
    [-0.01915359],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [-0.03830719],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.576807  ],
    [-0.01915359]],

    [[-1.2258313 ],
    [-0.01915359],
    [ 0.34476504],
    [-0.01915359],
    [ 9.576807  ],
    [ 0.        ]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2641385 ],
    [ 0.03830719],
    [ 0.34476504],
    [-0.01915359],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.36391866],
    [-0.01915362],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.34476504],
    [ 0.01915362],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.519346  ],
    [ 0.03830719]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.30645782],
    [ 0.01915362],
    [ 9.5385    ],
    [-0.01915359]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.30645782],
    [ 0.        ],
    [ 9.5385    ],
    [ 0.        ]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.30645782],
    [ 0.        ],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2258313 ],
    [-0.01915359],
    [ 0.30645782],
    [ 0.        ],
    [ 9.595961  ],
    [-0.03830719]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.32561144],
    [-0.01915362],
    [ 9.595961  ],
    [ 0.        ]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.        ],
    [ 9.576807  ],
    [ 0.01915359]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.36391866],
    [-0.03830722],
    [ 9.576807  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [ 0.01915359],
    [ 0.34476504],
    [ 0.01915362],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.36391866],
    [-0.01915362],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.3024458 ],
    [ 0.0574609 ],
    [ 0.36391866],
    [ 0.        ],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.283292  ],
    [-0.01915371],
    [ 0.36391866],
    [ 0.        ],
    [ 9.615114  ],
    [-0.05746078]],

    [[-1.2449849 ],
    [-0.03830719],
    [ 0.36391866],
    [ 0.        ],
    [ 9.576807  ],
    [ 0.03830719]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.34476504],
    [ 0.01915362],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2641385 ],
    [ 0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.30645782],
    [ 0.01915362],
    [ 9.500193  ],
    [ 0.03830719]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.30645782],
    [ 0.        ],
    [ 9.557653  ],
    [-0.05746078]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.32561144],
    [-0.01915362],
    [ 9.5385    ],
    [ 0.01915359]],

    [[-1.283292  ],
    [ 0.01915359],
    [ 0.32561144],
    [ 0.        ],
    [ 9.595961  ],
    [-0.05746078]],

    [[-1.2449849 ],
    [-0.03830719],
    [ 0.34476504],
    [-0.01915359],
    [ 9.595961  ],
    [ 0.        ]],

    [[-1.2258313 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.576807  ],
    [ 0.01915359]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.34476504],
    [-0.01915359],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2066777 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2258313 ],
    [ 0.01915359],
    [ 0.34476504],
    [-0.01915359],
    [ 9.576807  ],
    [-0.01915359]],

    [[-1.2449849 ],
    [ 0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.615114  ],
    [-0.03830719]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.576807  ],
    [ 0.03830719]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.34476504],
    [-0.01915359],
    [ 9.576807  ],
    [ 0.        ]],

    [[-1.2258313 ],
    [-0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.01915359]],

    [[-1.2258313 ],
    [ 0.        ],
    [ 0.34476504],
    [ 0.        ],
    [ 9.519346  ],
    [ 0.03830719]],

    [[-1.2641385 ],
    [ 0.03830719],
    [ 0.34476504],
    [ 0.        ],
    [ 9.519346  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.5385    ],
    [-0.01915359]],

    [[-1.283292  ],
    [ 0.03830719],
    [ 0.34476504],
    [-0.01915359],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2641385 ],
    [-0.01915359],
    [ 0.34476504],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.34476504],
    [ 0.        ],
    [ 9.595961  ],
    [-0.03830719]],

    [[-1.2641385 ],
    [ 0.        ],
    [ 0.32561144],
    [ 0.01915359],
    [ 9.576807  ],
    [ 0.01915359]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.        ],
    [ 9.576807  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [ 0.        ],
    [ 0.30645782],
    [ 0.01915362],
    [ 9.5385    ],
    [ 0.03830719]],

    [[-1.2258313 ],
    [-0.01915359],
    [ 0.32561144],
    [-0.01915362],
    [ 9.557653  ],
    [-0.01915359]],

    [[-1.2641385 ],
    [ 0.03830719],
    [ 0.32561144],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.2449849 ],
    [-0.01915359],
    [ 0.32561144],
    [ 0.        ],
    [ 9.557653  ],
    [ 0.        ]],

    [[-1.340753  ],
    [ 0.09576809],
    [ 0.2873042 ],
    [ 0.03830725],
    [ 9.500193  ],
    [ 0.05746078]],

    [[-1.091756  ],
    [-0.24899697],
    [ 0.36391866],
    [-0.07661447],
    [ 9.595961  ],
    [-0.09576797]],

    [[-1.5131354 ],
    [ 0.42137945],
    [ 0.34476504],
    [ 0.01915362],
    [ 9.519346  ],
    [ 0.07661438]],

    [[-1.340753  ],
    [-0.17238247],
    [ 0.34476504],
    [ 0.        ],
    [ 9.519346  ],
    [ 0.        ]],

    [[-1.091756  ],
    [-0.24899697],
    [ 0.36391866],
    [-0.01915362],
    [ 9.557653  ],
    [-0.03830719]],

    [[-1.2641385 ],
    [ 0.17238247],
    [ 0.32561144],
    [ 0.03830722],
    [ 9.595961  ],
    [-0.03830719]],

    [[-1.3024458 ],
    [ 0.03830731],
    [ 0.32561144],
    [ 0.        ],
    [ 9.5385    ],
    [ 0.05746078]],

    [[-1.2449849 ],
    [-0.0574609 ],
    [ 0.36391866],
    [-0.03830722],
    [ 9.5385    ],
    [ 0.        ]],

    [[-1.1683705 ],
    [-0.07661438],
    [ 0.2873042 ],
    [ 0.07661447],
    [ 9.576807  ],
    [-0.03830719]]
]];

const predictRoads = async() => {
    console.clear();
    const loadedModel = await tf.loadLayersModel('file://assets/tensorFlowCore/roads/model.json');
    const tensor = tf.tensor4d(sample);
    console.log('tensor: ', tensor);
    try {
        const result = loadedModel.predict(tensor);
        return result.dataSync();
    } catch(error) {
        console.error(error);
        return error;
    }     
}

const predictRoadsCallback = (req, res) => {
    predictRoads()
    .then(response => {
        res.send(response);
    }, error => {
        console.log('there was an error.');
        res.send(error);
    });
};

const predictAnomaliesCallback = (req, res) => {
    res.send(["anomalies predicted!"]); 
};



module.exports = [ predictRoadsCallback, predictAnomaliesCallback ];